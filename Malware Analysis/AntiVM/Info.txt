

Anti-VM mechanisms are techniques used by malware to detect if it is running in a virtual environment (VM) rather than a physical, or "bare-metal," machine. By identifying VMs, malware can evade analysis by security researchers and analysts, often by disabling its malicious functions or self-deleting to avoid detection. These techniques exploit differences in performance, instruction behavior, registry entries, and hardware addresses (like MAC addresses) between virtual and physical systems to determine if the environment is virtualized. 

- - - 

How Anti-VM Mechanisms Work

Malware uses various checks to identify virtual environments: 

Hardware & Network Identifiers:
MAC Addresses: Malware can detect common MAC address prefixes associated with virtual machine vendors like VMware (00:50:56) or VirtualBox (08-00-27). 
CPU Information: It can check the output of CPU instructions like CPUID to see if the processor information indicates a virtualized CPU rather than a physical one. 

- - - 

Software & System Artifacts:
Registry Keys: Malware can look for registry entries that are specific to VM software, such as entries under the HKLM\SOFTWARE\Vmware Inc. key. 
Process & Driver Names: It can scan for process names or drivers commonly associated with virtualization software and sandboxes. 

- - - 

Timing and Performance Differences:
Execution Timing: Malware can perform complex computations and measure the time it takes to execute them, comparing the results to known execution times on physical hardware. 
Instruction Behavior: Some instructions have undefined behavior in certain CPU architectures, but the behavior in a VM might differ from the expected behavior on a physical machine. Malware can exploit these discrepancies. 

- - - 

System Configuration & Resources:
Disk Space & Memory: Malware might check if the disk has a smaller size than typical physical installations or if the amount of RAM is insufficient for a real-world scenario. 
Usernames: It can look for specific usernames often associated with malware analysis environments. 
